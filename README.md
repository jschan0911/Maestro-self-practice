# 마에스트로 API 명세 작성 현황

## 🙂 유저 관련
- [ ] 회원 가입 : 아이디, 비밀번호, 이메일, 닉네임 입력 [(논의 필요)](#이런-내용은-논의해보고-싶습니다)
  - [ ] 이메일 형식 맞는지 검증
  - [ ] 이메일 중복인지 검증 (미정)
  - [ ] 이메일 인증 (미정)
  - [ ] 비밀번호 조건 부합하는지 검증 (미정)
  - [ ] 닉네임에 비속어 포함되었는지 여부 검증 (미정)
  - [ ] 닉네임 중복 여부 검증 (미정)
<pre><code>POST: /user/signup
# Request
{ 
  "userID" : "inhaKim2022",
  "password1" : "@qwer1234",
  "password2" : "@qwer1234",
  "nickname" : "김인하",
  "userEmail" : "inhaKim2022@naver.com"
}
</code></pre>
- [ ] 로그인
  - [ ] 로그인 시 접속에 관한 booleanField 활성화
<pre><code>POST: /user/login
# Request
{
  "userID" : "inhaKim2022",
  "password" : "@qwer1234"
}
</code></pre>

## 👥 팀 관련
- [ ] 팀 생성 : 팀 이름, 팀을 설명할 사진 (프사) 입력
<pre><code>POST: /team
# Request
{
  "teamName" : "멋쟁이 사자 밴드",
  "teamImage" : "../../사진파일.JPG"  // 형식 모르겠음 ㅎㅎ
}
</code></pre>
- [ ] 팀 수정
<pre><code>PUT: /team/{teamID}
# Request
{
  "teamName" : "멋쟁이 사자 밴드 수정 버전",
  "teamImage" : "../../사진파일.JPG"
}
</code></pre>
- [ ] 팀 삭제
<pre><code>DELETE: /team/{teamID}</code></pre>
- [ ] 팀 우선 순위 설정 (별 표시 클릭시 위 쪽으로 나오게)
  - [ ] 소속 팀 테이블에서 제거
  - [ ] 중요 팀 테이블에 추가
<pre><code>POST : /team/priority/{teamIO}
</code></pre>
- [ ] 신규 팀원 가입 시
  - [ ] 총 인원 수 추가
  - [ ] 유저 모델 내 소속 팀 테이블에 추가
<pre><code>POST: /user/team/{teamID}</code></pre>
- [ ] 기존 팀원 탈퇴
  - [ ] 총 인원 수 감소
  - [ ] 유저 모델 내 소속 팀 or 중요 팀 테이블에서 제거
<pre><code>DELETE: /user/team/{teamID}</code></pre>
#### 약간 유저 관련? (유저 모델 내 팀 테이블이 ManyToMany 연결 관계라 유저와 관련이 있다고 생각했음)
- [ ] 유저가 속해있는 팀 목록 조회
  - [ ] 어떤 팀 페이지에 접속해있는지 판별 : 접속한 팀에 관한 정보(pk?)를 불러와 저장 [(논의 필요)](#이런-내용은-논의해보고-싶습니다)
  - [ ] 팀에 속한 팀원 중, 현재 팀 페이지 이하에 접속 중인 인원 수 계산 [(논의 필요)](#이런-내용은-논의해보고-싶습니다)
<pre><code>GET: /team
# Response
{
  "specialTeams" : [
    {
      "id" : 3,
      "teamName" : "인천광역시 밴드"
      "teamImage" : "../../사진파일3.JPG",
      "connectedPeopleNumber" : 3,
      "totalPeopleNumber" : 7
    }
  ],
  "normalTeams" : [
    {
      "id" : 1,
      "teamName" : "멋쟁이 사자 밴드",
      "teamImage" : "../../사진파일.JPG"
      "connectedPeopleNumber" : 5,
      "totalPeopleNumber" : 5
    },
    {
      "id" : 4,
      "teamName" : "인하대학교 밴드부"
      "teamImage" : "../../사진파일4.JPG"
      "connectedPeopleNumber" : 2,
      "totalPeopleNumber" : 6
    }
  ]
}

//논의 필요 : 페이지 접속 시 접속 팀에 대한 정보를 불러와 저장하는 작업은 GET이 아님!</code></pre>
- [ ] 팀에 유저를 초대 [(논의 필요)](#이런-내용은-논의해보고-싶습니다)
  - [ ] 초대하는 링크 생성
  - [ ] 해당 링크 접속한 유저를 팀에 가입 시킴
<pre><code>POST: /user/team/{teamID}  //신규 팀원 가입 URL과 같음 (똑같은 기능)</code></pre>

## 📚 콘티(폴더) 관련
- [ ] 폴더 생성 : 폴더 이름, 폴더를 설명할 사진 (프사), 어떤 팀의 폴더인지에 대한 정보 입력
  - [ ] 폴더 생성 시, 어떤 팀의 폴더인지를 나타내는 테이블에 자동으로 {teamID} 추가 (사용자가 입력하지 않아도)
<pre><code>POST: /folder/{teamID}
# Request
{
  "folderName" : "동아리 축제 공연 노래 모음",
  "folderImage" : "../../사진파일10.JPG",
}</code></pre>
- [ ] 폴더 수정
<pre><code>PUT: /folder/{teamID}/{folderID}
# Request
{
  "folderName" : "동아리 축제 공연 노래 모음",
  "folderImage" : "../../사진파일11.JPG",
}</code></pre>
- [ ] 폴더 삭제
<pre><code>DELETE: /folder/{teamID}/{folderID} </code></pre>
- [ ] 특정 팀이 보유한 폴더 목록 보여줌
<pre><code>GET: /folder/{teamID} 
# Response
{
  "folderLists" : [
    {
      "id" : 1,
      "folderName" : "동아리 축제 공연 노래 모음",
      "folderImage" : "../../사진파일11.JPG",
      "teamID" : 13
    },
    {
      "id" : 3,
      "folderName" : "11월 14일 버스킹",
      "folderImage" : "../../사진파일13.JPG",
      "teamID" : 13
    },
    {
      "id" : 6,
      "folderName" : "전국 대학 밴드 경진대회",
      "folderImage" : "../../사진파일16.JPG",
      "teamID" : 13
    },
    {
      "id" : 7,
      "folderName" : "외부 축제 공연",
      "folderImage" : "../../사진파일17.JPG",
      "teamID" : 13
    }
  ]
}</code></pre>

## 📖 곡 관련
- [ ] 곡 생성 : 곡 이름, BPM 정보, 악보 파일, 어떤 폴더의 곡인지에 대한 정보 입력
  - [ ] 곡 생성 시, 어떤 폴더의 곡인지를 나타내는 테이블에 자동으로 {folderID} 추가 (사용자가 입력하지 않아도)
<pre><code>POST: /music/{folderID}
# Request
{
  "musicName" : "사건의 지평선",
  "musicBPM" : 98,
  "sheetMusic" : "../../사진파일31.JPG" //악보
}</code></pre>
- [ ] 곡 수정
<pre><code>PUT: /music/{folderID}/{musicID}
# Request
{
  "musicName" : "사건의 지평선",
  "musicBPM" : 100,
  "sheetMusic" : "../../사진파일31.JPG"
}</code></pre>
- [ ] 곡 삭제
<pre><code>DELETE: /music/{folderID}/{musicID}</code></pre>
- [ ] 특정 폴더 내 곡 목록 보여줌
<pre><code>GET: /music/{folderID}
# Response
{
  "musicLists" : [
    {
      "id" : 8,
      "musicName" : "사건의 지평선",
      "musicBPM" : 100,
      "sheetMusic" : "../../사진파일31.JPG",
      "folderID" : 2
    },
    {
      "id" : 10,
      "musicName" : "별 보러 가자",
      "musicBPM" : 70,
      "sheetMusic" : "../../사진파일32.JPG",
      "folderID" : 2
    },
    {
      "id" : 11,
      "musicName" : "그라데이션",
      "musicBPM" : 105,
      "sheetMusic" : "../../사진파일33.JPG",
      "folderID" : 2
    }
  ]
}</code></pre>

## 🎶 팀과 공유하는 메트로놈 관련
- [ ] 동기화를 적용할 시간을 설정함 [(논의 필요)](#이런-내용은-논의해보고-싶습니다)

---

# 수정 / 추가 작업이 필요할 것 같습니다!

- [x] 팀 수정 버튼 및 페이지가 필요할 것 같습니다.
- [x] 팀 클릭 시 이동할 '콘티 (폴더) 모음 페이지'가 필요할 것 같습니다.
- [ ] 콘티 수정 버튼 및 페이지가 필요할 것 같습니다.
- [ ] 동기화를 적용할 시간을 설정하는 페이지가 필요할 것 같습니다. (알람 설정 느낌)
- [ ] 팀 삭제 시 본인 유저 모델 내 소속 팀 or 특수 팀 테이블에서 삭제하는 것인지, 팀 모델 자체를 삭제하는 것인지 구분하는 페이지가 필요할 것 같습니다.

---

# 이런 내용은 논의해보고 싶습니다!

- 초대 링크에 접속한 어떤 유저든 가입할 수 있도록 처리할 것인가요? (이건 일단 해봐야 알 것 같긴 합니다만..) => X, 로그인 인증을 통해 처리!
- 현재 접속 중인 인원 수를 세는 이유가 원활한 합주를 진행하기 위함이라면, </br>
  팀 페이지에 접속한 유저를 카운트하기 보다는 </br>
  콘티(폴더) 페이지에 접속한 유저를 카운트 하는 건 어떨까요? </br></br>
  왜냐하면 팀 안에도 여러 개의 콘티(폴더)가 있을 텐데, </br>
  합주하는 팀원 중 몇 명이 같은 콘티(폴더)를 보고 있는지에 대한 정보가 궁금할 것 같기 때문입니다. => 일단 OK! 그러나 추후에 다시 생각해보기로!
- [팀과 공유하는 메트로놈 관련](#🎶-팀과-공유하는-메트로놈-관련) 내 '동기화를 적용할 시간을 설정'하는 작업은 언제 적용하는 것이 좋을까요? => 곡 별로 설정하므로 곡 선택시!
- [회원가입 할 때](#🙂-유저-관련) 조건들을 추가해보는 건 어떨까요?
  - 회원가입시 이메일로 인증
  - 회원가입시 비밀번호 설정할 때 조건 설정 (특수번호, 몇 자리수 이상, ...)
  - 닉네임 설정 중, 비속어 필터링, 중복 필터링 ...
- 초대 링크 외에 팀을 추가할 수 있는 다른 방법이 있을까요? => 있는 걸로! 예) 팀장이 초대, Or 팀원이 검색 (오픈채팅방처럼)
- 합주 중 팀원의 출입이나 다른 조건들(bpm, 일시정지 등)을 실시간으로 변경할 수 있도록 처리할 것인가요? => X, 팀장만이 설정할 수 있으며, 합주 중에는 변경 불가
- 합주했던 기록을 콘티(폴더)나 팀 페이지에 따로 추가하는 것은 어떤가요? => 좋은 생각인듯! 추후에 다시 생각해보기로!
- 합주를 시작할 수 있는 권한은 어떻게 부여할까요? 여러 사람에게 권한이 있을 경우, 한 팀 내에 여러 개의 합주가 가능할까요? => 팀장만이 시작할 수 있으며, 팀 당 하나의 합주만 가능한 걸로

  
  
# 추가되어야 할 디자인
- 프로필 조회 & 수정 페이지 : 프로필에 어떤 데이터가 조회되어야 하는가?
- 팀원 초대 페이지 => 기본적인 팀원 초대 페이지가 따로 존재하는지? 아니면 현재 피그마 디자인 그대로 카카오톡 초대 기능만 존재하는지?
- 로그인 페이지
- 팀(그룹) 관련수정 : 해당 그룹에 대해 관리자가 따로 존재하는지? 만일 존재한다면 관리자만 그룹명이나 팀 이미지 등을 수정하는하게 할건지 허용 범위가 어디까지 되는가?
- 팀 탈퇴 기능도 있는지? 당연히 있겠지만 혹시 모르니.
- 해당 팀에 속한 인원이 0명이 된 경우, 해당 팀을 아예 삭제시켜버린것인지? (ex. '미에스트로' 팀을 검색창에서 검색해도 이전에 삭제된 팀이라 절대 안나옴)
- 동기화 적용 후, 팀원 대기 페이지에서 보여줄 내용은? (대기 중/전 팀원, 남은 대기시간)
- 

# 1차배포 이후에 추가되어야 할 디자인
- 결제창 (redirect 처리 요망) : In-app Billing (카카오페이)
- 트랜잭션

---

# 회의때 논의할것

![image](https://user-images.githubusercontent.com/88240193/203247919-25abe7d6-0d94-4f00-bcff-f9c40d08e16e.png)


1. 팀원을 내보내기 : 해당 팀에서 아예 영구적으로 탈퇴시키는 것인지, 아니면 메트로늄 합주 방에서만 탈퇴시키는 것인지

2. 방장 관련
- 방을 판 사람이 팀장
- 방을 판 사람이 안들어오면 가장 먼저 들어온 사람이 팀장
- 합주가 끝나도 방을 안나가면 방장을 그대로 유지

=> 방


3. 추가되어야 할 필드 + API

- 누가 방장인지

#### 한번 방에서 나온 사람은 다시 방에 들어가지 못하도록 막는것과 관련한 DB 필드 + API
 
 db 필드
- Mapping 테이블에 Boolean 필드 추가 (isConnected => 해당 유저가 합주방에 들어가있는지 여부) 
- Team 테이블에 필드 추가 (해당 팀이 합주방에서 합주를 시작했는지 여부)

API 
- 해당 합주방에서 나온 사람에 대해 Mapping 테이블의 isConnected 필드를 False 로 변경
- 합주방에 들어가려고 시도할때 해당 합주방이 합주가 시작되었는지 여부를 체크하고, 아직 시작 안했다면 들어가고 시작 했따면 들어가도록 하는 API








  
